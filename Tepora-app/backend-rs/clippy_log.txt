    Checking tepora-backend v0.3.0-beta (E:\Tepora_Project\Tepora-app\backend-rs)
error: unused import: `HashMap`
 --> src\graph\nodes\agent_executor.rs:6:24
  |
6 | use std::collections::{HashMap, HashSet};
  |                        ^^^^^^^
  |
  = note: `-D unused-imports` implied by `-D warnings`
  = help: to override `-D warnings` add `#[allow(unused_imports)]`

error: unused import: `tool::ToolNode`
  --> src\graph\nodes\mod.rs:21:9
   |
21 | pub use tool::ToolNode;
   |         ^^^^^^^^^^^^^^

error: unused imports: `NodeContext`, `NodeOutput`, and `Node`
  --> src\graph\mod.rs:13:16
   |
13 | pub use node::{Node, NodeContext, NodeOutput};
   |                ^^^^  ^^^^^^^^^^^  ^^^^^^^^^^

error: unused import: `runtime::GraphRuntime`
  --> src\graph\mod.rs:14:9
   |
14 | pub use runtime::GraphRuntime;
   |         ^^^^^^^^^^^^^^^^^^^^^

error: unused imports: `AgentMode`, `AgentState`, `Mode`, and `SharedContext`
  --> src\graph\mod.rs:15:17
   |
15 | pub use state::{AgentMode, AgentState, Mode, SharedContext};
   |                 ^^^^^^^^^  ^^^^^^^^^^  ^^^^  ^^^^^^^^^^^^^

error: unused variable: `mcp_tool_set`
  --> src\graph\nodes\agent_executor.rs:61:13
   |
61 |         let mcp_tool_set: HashSet<String> = mcp_tools.iter().map(|t| t.name.clone()).collect();
   |             ^^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_mcp_tool_set`
   |
   = note: `-D unused-variables` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(unused_variables)]`

error: field `payload` is never read
   --> src\api.rs:499:5
    |
498 | struct PendingConsent {
    |        -------------- field in this struct
499 |     payload: Value,
    |     ^^^^^^^
    |
    = note: `-D dead-code` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(dead_code)]`

error: field `db_path` is never read
  --> src\history.rs:47:5
   |
46 | pub struct HistoryStore {
   |            ------------ field in this struct
47 |     db_path: PathBuf,
   |     ^^^^^^^
   |
   = note: `HistoryStore` has derived impls for the traits `Clone` and `Debug`, but these are intentionally ignored during dead code analysis

error: method `db_path` is never used
  --> src\history.rs:74:12
   |
51 | impl HistoryStore {
   | ----------------- method in this implementation
...
74 |     pub fn db_path(&self) -> &PathBuf {
   |            ^^^^^^^

error: function `extract_env_schema` is never used
   --> src\mcp_installer.rs:132:8
    |
132 | pub fn extract_env_schema(server: &McpRegistryServer) -> Vec<McpEnvVar> {
    |        ^^^^^^^^^^^^^^^^^^

error: function `get_available_runtimes` is never used
   --> src\mcp_installer.rs:136:8
    |
136 | pub fn get_available_runtimes(server: &McpRegistryServer) -> Vec<String> {
    |        ^^^^^^^^^^^^^^^^^^^^^^

error: field `license` is never read
  --> src\mcp_registry.rs:62:9
   |
52 | pub struct McpRegistryServer {
   |            ----------------- field in this struct
...
62 |     pub license: Option<String>,
   |         ^^^^^^^
   |
   = note: `McpRegistryServer` has derived impls for the traits `Clone` and `Debug`, but these are intentionally ignored during dead code analysis

error: function `api_key_optional` is never used
   --> src\security.rs:117:8
    |
117 | pub fn api_key_optional(headers: &HeaderMap, expected: &SessionToken) -> Option<String> {
    |        ^^^^^^^^^^^^^^^^

error: field `started_at` is never read
  --> src\state.rs:25:9
   |
15 | pub struct AppState {
   |            -------- field in this struct
...
25 |     pub started_at: DateTime<Utc>,
   |         ^^^^^^^^^^
   |
   = note: `AppState` has a derived impl for the trait `Clone`, but this is intentionally ignored during dead code analysis

error: useless conversion to the same type: `std::path::PathBuf`
    --> src\api.rs:1933:51
     |
1933 |         let Some(relative) = entry.enclosed_name().map(PathBuf::from) else {
     |                                                   ^^^^^^^^^^^^^^^^^^^-
     |                                                   |
     |                                                   help: consider removing
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#useless_conversion
     = note: `-D clippy::useless-conversion` implied by `-D warnings`
     = help: to override `-D warnings` add `#[allow(clippy::useless_conversion)]`

error: clamp-like pattern without using clamp function
    --> src\api.rs:2252:5
     |
2252 | /     if page_size < 1 {
2253 | |         page_size = 1;
2254 | |     }
2255 | |     if page_size > 200 {
2256 | |         page_size = 200;
2257 | |     }
     | |_____^ help: replace with clamp: `page_size = page_size.clamp(1, 200);`
     |
     = note: clamp will panic if max < min
     = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#manual_clamp
     = note: `-D clippy::manual-clamp` implied by `-D warnings`
     = help: to override `-D warnings` add `#[allow(clippy::manual_clamp)]`

error: this expression can be written more simply using `.retain()`
    --> src\api.rs:2270:9
     |
2270 | /         servers = servers
2271 | |             .into_iter()
2272 | |             .filter(|server| {
2273 | |                 server.packages.iter().any(|pkg| {
...    |
2279 | |             })
2280 | |             .collect();
     | |______________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#manual_retain
     = note: `-D clippy::manual-retain` implied by `-D warnings`
     = help: to override `-D warnings` add `#[allow(clippy::manual_retain)]`
help: consider calling `.retain()` instead
     |
2270 ~         servers.retain(|server| {
2271 +                 server.packages.iter().any(|pkg| {
2272 +                     pkg.runtime_hint
2273 +                         .as_ref()
2274 +                         .map(|hint| hint.to_lowercase() == runtime_lower)
2275 +                         .unwrap_or(false)
2276 +                 })
2277 ~             });
     |

error: unnecessary closure used to substitute value for `Option::None`
   --> src\llama.rs:402:27
    |
402 |           let binary_path = guard
    |  ___________________________^
403 | |             .binary_path
404 | |             .clone()
405 | |             .ok_or_else(|| ApiError::ServiceUnavailable)?;
    | |________________________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#unnecessary_lazy_evaluations
    = note: `-D clippy::unnecessary-lazy-evaluations` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::unnecessary_lazy_evaluations)]`
help: use `ok_or` instead
    |
405 -             .ok_or_else(|| ApiError::ServiceUnavailable)?;
405 +             .ok_or(ApiError::ServiceUnavailable)?;
    |

error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`
   --> src\llama.rs:460:13
    |
460 | /             match self.client.get(&url).send().await {
461 | |                 Ok(response) => {
462 | |                     if response.status().is_success() {
463 | |                         if let Ok(payload) = response.json::<Value>().await {
...   |
470 | |                 Err(_) => {}
471 | |             }
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#single_match
    = note: `-D clippy::single-match` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::single_match)]`
help: try
    |
460 ~             if let Ok(response) = self.client.get(&url).send().await {
461 +                 if response.status().is_success() {
462 +                     if let Ok(payload) = response.json::<Value>().await {
463 +                         if payload.get("status").and_then(|v| v.as_str()) == Some("ok") {
464 +                             return Ok(());
465 +                         }
466 +                     }
467 +                 }
468 +             }
    |

error: this block may be rewritten with the `?` operator
   --> src\mcp.rs:541:9
    |
541 | /         if let Err(reason) = self.policy_allows_connection(name, server) {
542 | |             return Err(reason);
543 | |         }
    | |_________^ help: replace it with: `self.policy_allows_connection(name, server)?;`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#question_mark
    = note: `-D clippy::question-mark` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::question_mark)]`

error: called `Iterator::last` on a `DoubleEndedIterator`; this will needlessly iterate the entire iterator
  --> src\mcp_installer.rs:14:16
   |
14 |     let base = raw.split('/').last().unwrap_or(raw);
   |                ^^^^^^^^^^^^^^^------
   |                               |
   |                               help: try: `next_back()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#double_ended_iterator_last
   = note: `-D clippy::double-ended-iterator-last` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::double_ended_iterator_last)]`

error: very complex type used. Consider factoring parts into `type` definitions
   --> src\models.rs:162:22
    |
162 |         progress_cb: Option<&(dyn Fn(f32, &str) + Sync)>,
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#type_complexity
    = note: `-D clippy::type-complexity` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::type_complexity)]`

error: this function has too many arguments (9/7)
   --> src\models.rs:153:5
    |
153 | /     pub async fn download_from_huggingface(
154 | |         &self,
155 | |         repo_id: &str,
156 | |         filename: &str,
...   |
162 | |         progress_cb: Option<&(dyn Fn(f32, &str) + Sync)>,
163 | |     ) -> Result<ModelDownloadResult, ApiError> {
    | |______________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#too_many_arguments
    = note: `-D clippy::too-many-arguments` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::too_many_arguments)]`

error: unnecessary closure used to substitute value for `Result::Err`
   --> src\models.rs:391:22
    |
391 |         let config = self.config.load_config().unwrap_or_else(|_| Value::Null);
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#unnecessary_lazy_evaluations
help: use `unwrap_or` instead
    |
391 -         let config = self.config.load_config().unwrap_or_else(|_| Value::Null);
391 +         let config = self.config.load_config().unwrap_or(Value::Null);
    |

error: this function has too many arguments (9/7)
   --> src\models.rs:449:5
    |
449 | /     fn add_model_entry(
450 | |         &self,
451 | |         repo_id: &str,
452 | |         filename: &str,
...   |
458 | |         sha256: Option<String>,
459 | |     ) -> Result<ModelEntry, ApiError> {
    | |_____________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#too_many_arguments

error: writing `&PathBuf` instead of `&Path` involves a new object where a slice will do
  --> src\security.rs:66:34
   |
66 | fn apply_windows_token_acl(path: &PathBuf) {
   |                                  ^^^^^^^^ help: change this to: `&Path`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#ptr_arg
   = note: `-D clippy::ptr-arg` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::ptr_arg)]`

error: this expression creates a reference which is immediately dereferenced by the compiler
   --> src\ws.rs:300:13
    |
300 |             &state,
    |             ^^^^^^ help: change this to: `state`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#needless_borrow
    = note: `-D clippy::needless-borrow` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::needless_borrow)]`

error: this function has too many arguments (12/7)
   --> src\ws.rs:700:1
    |
700 | / async fn run_agent_mode(
701 | |     state: &AppState,
702 | |     config: &Value,
703 | |     session_id: &str,
...   |
712 | |     approved_mcp_tools: Arc<Mutex<HashSet<String>>>,
713 | | ) -> Result<String, ApiError> {
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.93.0/index.html#too_many_arguments

error: could not compile `tepora-backend` (bin "tepora-backend") due to 28 previous errors
